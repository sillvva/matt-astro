---
title: Astro Responsive Image
description: A responsive image component for Astro using srcset and sizes.
date: 2023-09-13T03:34:38.224Z
image: $/assets/images/astro.webp
tags:
  - Astro
  - TypeScript
  - UI
---
import CombinedBlock from "$/components/markdown/combined.astro";

The following is a custom component for Astro that generates a responsive image using the `srcset` and `sizes` attributes. It also uses the `getImage` function from the `astro:assets` module to generate the image URLs. The function uses the same compression as the built-in `<Image />` component from Astro.

<CombinedBlock>
```ts
---
import type { ImageOutputFormat } from "astro";
import { getImage, type ImgAttributes } from "astro:assets";

type Props = Omit<ImgAttributes, "sizes"> & {
    src: ImageMetadata;
    format?: ImageOutputFormat;
    sizes: number[];
    media?: string[];
};

async function generateResponsiveImage({ src, format, sizes }: Pick<Props, "src" | "format" | "sizes">) {
    const imgSrcSet = await Promise.allSettled(
        sizes.map(async (size) => {
            const image = await getImage({ src, width: size, format });
            return { src: `${image.src} ${size * 2}w`, size };
        })
    );

    const srcSet = imgSrcSet.map((result) => (result.status === "fulfilled" ? result.value.src : "")).filter(Boolean);
    const imgSrc = await getImage({ src, width: Math.min(...sizes), format });

    return {
        srcSet,
        imgSrc
    };
}

const { src, sizes, format, alt, id, media } = Astro.props;
const className = Astro.props.class;

const { srcSet, imgSrc } = await generateResponsiveImage({ src, sizes, format });
---
```
```tsx
<img srcset={srcSet.join(", ")} sizes={media?.join(", ")} {id} {alt} src={imgSrc.src} class={className} loading="lazy" />
```
</CombinedBlock>