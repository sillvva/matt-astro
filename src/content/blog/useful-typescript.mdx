---
title: Useful TypeScript Helpers
description: Useful functions and type helpers for TypeScript
date: 2023-09-07T03:18:13.471Z
updated: 2024-03-12T22:23:39.398Z
image: $/assets/images/typescript.png
tags:
  - TypeScript
---
import Collapsible from "$/components/markdown/collapsible.astro";
import Shiki from "$/components/markdown/shiki.astro";
import Tweet from "$/components/markdown/tweet.astro";

## Table of Contents

## Disclaimer

I want to preface this post with a disclaimer that the majority of the code in this post is not my own. I have collected it from various sources and have tried to give credit where credit is due. If you see something that you believe is your own work and I have not given you credit, please [let me know](https://github.com/sillvva/matt-astro/issues) and I will rectify the situation. If you see something that you believe is your own work and you would like it removed, please [let me know](https://github.com/sillvva/matt-astro/issues) and I will remove it.

## Type Declarations

### View Transition

The `startViewTransition` function is a method on the `document` object which enables view transitions. The following types are based on the documentation at MDN. Since the API is currently experimental, you may need to add the following type to your type declaration file to avoid errors. 

<div class="button-row">
  [Google Article](btn::https://developer.chrome.com/docs/web-platform/view-transitions/)
  [MDN](btn::https://developer.mozilla.org/en-US/docs/Web/API/Document/startViewTransition)
</div>

<Shiki code={`
declare global {
	interface ViewTransition {
		/**
		 * A Promise that fulfills once the transition animation is finished, 
		 * and the new page view is visible and interactive to the user.
		 */
		finished: Promise<void>;
		/**
		 * A Promise that fulfills once the pseudo-element tree is created 
		 * and the transition animation is about to start.
		 */
		ready: Promise<void>;
		/**
		 * A Promise that fulfills when the promise returned by the 
		 * document.startViewTransition()'s callback fulfills.
		 */
		updateCallbackDone: Promise<void>;
		/**
		 * Skips the animation part of the view transition, but doesn't skip 
		 * running the document.startViewTransition() callback that updates the DOM.
		 */
		skipTransition: () => void;
	}

	type ViewTransitionCallback = (() => Promise<void>) | (() => void);

	interface Document {
		startViewTransition: (callback: ViewTransitionCallback) => ViewTransition;
	}
}`} lang="ts" />

<Collapsible title="Using in SvelteKit">
  In SvelteKit, you can add the above type declaration to a file in the `src` directory, such as `src/types.d.ts`. Then you can add view transitions to your SvelteKit app by following the video below, ignoring the `@ts-ignore` comments.

  [YouTube](embed::https://www.youtube.com/watch?v=q_2irZO4SS8)
</Collapsible>

### Environment Variables

Environment variables can be declared in the `global` namespace to provide type information for `import.meta.env` and `process.env`. The following example demonstrates how to declare environment variables in TypeScript.

<Shiki code={`
declare global {
	interface ImportMetaEnv {
		MY_ENV: string;
	}
}

import.meta.env.MY_ENV; // string

declare global {
	namespace NodeJS {
		interface ProcessEnv {
			MY_ENV: string;
		}
	}
}

process.env.MY_ENV; // string
`} lang="ts" />

Keep in mind that this is type faith, not type safe. You can also use a schema validation library to parse your environment variables and infer the type from that. If a variable is missing, you can throw an error.

<div class="grid sm:grid-cols-2 gap-4">
  <Tweet link="https://twitter.com/mattpocockuk/status/1758454430666506589" />
  <Tweet link="https://twitter.com/mattpocockuk/status/1760991147793449396" />
</div>

## Utility Types

### Combine/Prettify Two Object Types

The `Prettify` type is a simple type which takes an object type with intersections and combines them to make them easier to read. The `Combine` type is a simple type which takes 2 object types and combines them into one.

<Shiki id="CombinePrettify.md" />

<div class="grid sm:grid-cols-2 gap-4">
  <Tweet link="https://twitter.com/mattpocockuk/status/1622730173446557697" />
  <Tweet link="https://twitter.com/mattpocockuk/status/1622730175266926592" />
  <Tweet link="https://twitter.com/mattpocockuk/status/1622730176931983360" />
  <Tweet link="https://twitter.com/mattpocockuk/status/1622730179289251840" />
  <Tweet link="https://twitter.com/mattpocockuk/status/1712391832573718721" />
</div>

### Merge Union Types

The `MergeUnion` type is a utility type that does as its name suggests. It takes multiple union types and merges them into one.

<Shiki id="MergeUnion.md" />

## Type Guards

### IsAny

You can (ab)use the fact that any is both a subtype and a supertype of almost everything (except for never). So the inner [(Distributive) Conditional Type](https://www.typescriptlang.org/docs/handbook/2/conditional-types.html#distributive-conditional-types) resolves to a Union of `true | false (=boolean)` instead of either of them.

<div class="button-row">
	[Playground](btn::https://www.typescriptlang.org/play?#code/C4TwDgpgBAkgzgQQHYgDwBUB8UC8UBGA9oQDYQCGSUEAHsBEgCZxQAU61dDzUSEAbhABOUAPxRgQgK7QAXFABm5EnAgBKMROlzFy1QG4AsACgToSFAS5YiFKkohMJgPTOo7gHqiz4aACFreGQ0JCkAW3xhJ2NXdygvHwsAYUDbNCkkAGskQgB3JGjYz29jc2gAEVTg1D5BIUK3YsToAFEqu35CAEtGBriE0t8oADF2tABvAF8+psGLAHEx1EJ8ACsIAGNgGfiSsqgACSWMxggFLr5el0bd5tgl0JISHa8gA)
  [Source](btn::https://stackoverflow.com/a/77451367/70894)
</div>

<Shiki code={`
type IsAny<T> = boolean extends (T extends never ? true : false) ? true : false;
`} lang="ts" />

## Superforms Types

The following types are used by [sveltekit-superforms](https://github.com/ciscoheat/sveltekit-superforms) and are useable under the MIT license which must be included with all copies.

<Collapsible title="MIT License">
Copyright (c) 2023 Andreas SÃ¶derlund

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
</Collapsible>

### SuperStruct

The `SuperStruct` type is a utility type that transforms the properties of an object to an alternative provided type. It is used by [sveltekit-superforms](https://github.com/ciscoheat/sveltekit-superforms) to transform the properties of a form schema to a type used for validation errors.

<Shiki id="SuperStruct.md" />

#### Example

<Shiki code={`
type LogData = {
  id: number;
  message: string;
  date: string;
  user: {
    id: number;
    name: string;
  };
  tags: string[];
}

type LogErrors = SuperStruct<LogData, string[]>;

// Converts each property to string[] | undefined
// LogErrors["id"] => string[] | undefined

// Converts objects into a partial with each property as string[] | undefined
// LogErrors["user"] => Partial<{ id: string[], name: string[] }> | undefined
// Exclude<LogErrors["user"], undefined>["id"] => string[] | undefined

// Converts the tags array itself to string[] | undefined
// LogErrors["tags"] => string[] | undefined

type LogErrors = SuperStructArray<LogData, string[]>;

// Converts each property to string[] | undefined
// LogErrors["id"] => string[] | undefined

// Converts objects into an object with the same SuperStructArray type
// LogErrors["user"] => SuperStructArray<LogData["user"], string[]> | undefined
// Exclude<LogErrors["user"], undefined>["id"] => string[] | undefined

// Converts each value in the tags array to a string[] type
// LogErrors["tags"] => Record<number, string[]> | undefined
`} lang="ts" />

### FormPathLeaves

The `FormPathLeaves` type is a utility type that takes an object type and returns a union of all the leaf paths of the object. It has an optional second parameter to specify the type (ex. `Date` or `number`) of paths to return. This is also used by [sveltekit-superforms](https://github.com/ciscoheat/sveltekit-superforms).

<Shiki id="FormPathLeaves.md" />

#### Example

Given the following object type, we can see the different types of paths that can be generated.

<Shiki code={`
type LogData = {
  id: number;
  message: string;
  date: Date;
  user: {
    id: number;
    name: string;
  };
  tags: string[];
}

type LogLeaves = FormPathLeaves<LogData>;
//   ^? "id" | "message" | "date" | "user.id" | "user.name" | \`tags[\${number}]\`
type LogStringLeaves = FormPathLeaves<LogData, string>;
//   ^? "message" | "user.name" | \`tags[\${number}]\`
type LogNumberLeaves = FormPathLeaves<LogData, number>;
//   ^? "id" | "user.id"
type LogDateLeaves = FormPathLeaves<LogData, Date>;
//   ^? "date"
`} lang="ts" />

### Set Nested Value

Below is a `setValue` function which takes an object, a path, and a value. It is not from the Superforms library, but rather showcases how some of the above types can be used.

The path is a string of dot-separated keys. The function should set the value at the given path. The path parameter will have autocomplete and the value parameter will be required to be of the same type as the property at that path. See the playground for examples. This function works very similarly to [lodash.set](https://lodash.com/docs/4.17.15#set), but with stronger type safety.

<Shiki code={`
function setValue<
	T extends Record<string, unknown>,
	P extends FormPathLeaves<T>,
	V extends FormPathType<T, P>
>(obj: T, path: P, value: V) {
	if (typeof path === "string") {
		const pList = path
			.split(/[[\\].]+/)
			.filter(Boolean);
		const lastKey = pList.pop();
		const pointer = pList.reduce(
			(accumulator: { [x: string]: any }, currentValue: string | number) => {
				if (accumulator[currentValue] === undefined)
					accumulator[currentValue] = {};
				return accumulator[currentValue];
			},
			obj
		);
		if (typeof lastKey !== "undefined") {
			if (pointer[lastKey] && typeof pointer[lastKey] !== typeof value) 
				throw new Error("Invalid value type");
			pointer[lastKey] = value;
			return obj;
		}
	}
	return obj;
}
`} lang="ts" />

#### Example

Using the object from the previous example, we can set the value of the `date` property to a `Date` object, and the value of the `tags[0]` property to a string. We can also see that trying to set the `date` property to a string will result in a type error.

<Shiki code={`
setValue(logData, "date", new Date("2023-02-01")); // good
setValue(logData, "tags[0]", "test");              // good
setValue(logData, "date", "2024-01-01");           // error
`} lang="ts" />