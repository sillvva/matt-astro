---
import type { Props as HeadProps } from "$components/head.astro";
import ResponsiveImage from "$src/components/responsive-image.astro";
import { slugify, sorter } from "$src/util";
import PortfolioLayout from "./portfolio.astro";

interface Props extends HeadProps {
	slug: string;
	data: {
		updated?: Date | undefined;
		title: string;
		description: string;
		image: {
			height: number;
			src: string;
			width: number;
			format: "png" | "webp" | "jpeg" | "jpg" | "svg" | "tiff" | "gif";
		};
		full: boolean;
		date: Date;
		tags: string[];
	};
}

const { title, description, image, full, date, updated, tags } = Astro.props.data;
const slug = Astro.props.slug;

const formattedDate = new Date(date).toLocaleDateString("en-US", {
	month: "long",
	day: "numeric",
	year: "numeric"
});
const formattedUpdate = new Date(updated || "").toLocaleDateString("en-US", {
	month: "long",
	day: "numeric",
	year: "numeric"
});
---

<PortfolioLayout
	{title}
	{description}
	image={image.src}
	stylesheets={["/styles/prism-one-dark.css"]}
	articleMeta={{
		published_date: date.toISOString(),
		...(updated && { modified_date: updated.toISOString() })
	}}
	backTo={{
		href: "/blog",
		text: "Blog"
	}}
>
	<article class="mx-auto flex max-w-4xl flex-col gap-4">
		<p class="text-center text-sm text-theme-faded md:text-left" aria-label="Date published">
			Published: <span class="underline decoration-dotted underline-offset-2">{formattedDate}</span>
			{
				updated && (
					<span class="block 2xs:inline 2xs:pl-4">
						Updated: <span class="underline decoration-dotted underline-offset-2">{formattedUpdate}</span>
					</span>
				)
			}
		</p>
		{
			!full && (
				<div class="relative aspect-video" transition:name={`image_${slug}`}>
					<ResponsiveImage
						src={image}
						alt={title}
						sizes={[300, 600, 900]}
						class="h-full w-full object-cover object-center shadow shadow-black/50"
					/>
				</div>
			)
		}
		{
			tags.length && (
				<section class="flex gap-4 pb-6">
					<h2 class="hidden text-xl sm:block">Tags</h2>
					<ul class="flex flex-1 flex-wrap justify-center gap-2 sm:justify-end">
						{tags
							.sort((a, b) => sorter(a, b))
							.map((tag) => (
								<li>
									<a href={`/blog/${slugify(tag)}`} class="btn btn-sm uppercase">
										{tag}
									</a>
								</li>
							))}
					</ul>
				</section>
			)
		}
		<section>
			<slot />
		</section>
	</article>
</PortfolioLayout>
